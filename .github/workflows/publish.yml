name: Publicar en NPM

on:
  push:
    branches:
      - main

jobs:
  publicar:
    name: Publicar Librer칤a
    runs-on: ubuntu-latest

    # Permisos OBLIGATORIOS para Trusted Publishers
    permissions:
      contents: write
      issues: write
      id-token: write

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Configurar Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20.x"
          # IMPORTANTE: Eliminamos 'registry-url' para evitar conflictos con .npmrc
          # La autenticaci칩n la manejar치 semantic-release internamente.

      - name: Actualizar NPM
        run: npm install -g npm@latest

      - name: Instalar dependencias
        run: npm install

      - name: Semantic Release
        uses: cycjimmy/semantic-release-action@v4
        with:
          extra_plugins: |
            @semantic-release/changelog
            @semantic-release/git
            @semantic-release/github 
            @semantic-release/npm
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          # 游릭 ELIMINADO: NPM_TOKEN
          # Al quitarlo, semantic-release usar치 la autenticaci칩n OIDC (Trusted Publishers)
